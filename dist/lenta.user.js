// ==UserScript==
// @name         Lenta List Clean
// @description  Remove product cards by filter
// @match        https://*.online.lenta.com/*
// @namespace    https://github.com/reliable-code/product-list-filters
// @version      0.2.69670137
// @icon         https://www.google.com/s2/favicons?sz=64&domain=lenta.com
// @author       reliable-code
// ==/UserScript==

(()=>{"use strict";


function getFirstElement(parentNode,selector,logNotFound=false){const element=parentNode.querySelector(selector);logNotFound&&!element&&console.log(`No element found for selector: ${selector}`);return element}function getAllElements(parentNode,selector,logNotFound=false){const elements=parentNode.querySelectorAll(selector);logNotFound&&!elements.length&&console.log(`No elements found for selector: ${selector}`);return elements}function hideElement(element){setElementDisplay(element,"none")}function showElement(element,display="block"){setElementDisplay(element,display)}function setElementDisplay(element,display){element.style.display=display}function updateValue(event,keyName,needReload=true){const{target}=event;const{type}=target;let valueToSet;if(type==="number")valueToSet=target.value;else{if(type!=="checkbox"){console.log(`Unknown input type: ${type}`);return null}valueToSet=target.checked}localStorage.setItem(keyName,valueToSet);needReload&&window.location.reload();return valueToSet}function createFilterControlNumber(titleText,inputValue,inputStep,inputMinValue,inputMaxValue,inputOnChange,controlStyle="",inputStyle=""){const filterControl=createDiv(titleText,controlStyle);const input=createBaseInput(inputOnChange,inputStyle);input.type="number";input.value=inputValue;input.step=inputStep;input.min=inputMinValue;input.max=inputMaxValue;filterControl.append(input);return filterControl}function createFilterControlCheckbox(titleText,isChecked,inputOnChange,controlStyle="",inputStyle=""){const filterControl=createDiv(titleText,controlStyle);const input=createBaseInput(inputOnChange,inputStyle);input.type="checkbox";input.checked=isChecked;filterControl.append(input);return filterControl}function createBaseInput(inputOnChange,style){const input=document.createElement("input");input.addEventListener("change",inputOnChange);input.style=style;return input}function createDiv(textContent,style=""){const div=document.createElement("div");div.textContent=textContent;div.style=style;return div}function getElementInnerNumber(element,cleanText=false){let elementText=element.innerText;cleanText&&(elementText=elementText.replace(/\D/g,""));const elementNumber=+elementText;return elementNumber}function appendFilterControlsIfNeeded(parentNode,appendFiltersContainerFunc,filtersContainerId="customFiltersContainer"){let filtersContainer=getFirstElement(parentNode,`#${filtersContainerId}`);if(filtersContainer)return;filtersContainer=document.createElement("div");filtersContainer.id=filtersContainerId;appendFiltersContainerFunc(filtersContainer,parentNode)}


function getLocalStorageValueOrDefault(key,defaultValue){const localStorageItem=localStorage.getItem(key);return localStorageItem?JSON.parse(localStorageItem):defaultValue}


const MIN_RATING=4;const NO_RATING=false;const MIN_RATING_LOCAL_STORAGE_KEY="min-rating-filter";const NO_RATING_LOCAL_STORAGE_KEY="no-rating-filter";const PRODUCT_CARD_LIST_SELECTOR=".catalog-list";const PRODUCT_CARD_SELECTOR=".catalog-grid_new__item";const PRODUCT_CARD_RATING_SELECTOR=".rating-number";let minRatingValue=getLocalStorageValueOrDefault(MIN_RATING_LOCAL_STORAGE_KEY,MIN_RATING);let noRatingChecked=getLocalStorageValueOrDefault(NO_RATING_LOCAL_STORAGE_KEY,NO_RATING);setInterval(initListClean,500);function initListClean(){const productCardList=getFirstElement(document,PRODUCT_CARD_LIST_SELECTOR);if(productCardList){appendFilterControlsIfNeeded(productCardList,appendFiltersContainer);cleanList()}}function appendFiltersContainer(filtersContainer,parentNode){filtersContainer.style="display: flex;"+"grid-gap: 15px;"+"margin-left: 10px;";const controlStyle="display: flex;"+"align-items: center;";const numberInputStyle="border: 1px solid #C9C9C9;"+"border-radius: 8px;"+"height: 40px;"+"padding: 0 16px;";const checkboxInputStyle="border: 1px solid #C9C9C9;"+"border-radius: 4px;"+"width: 22px;"+"height: 22px;";const minRatingDiv=createFilterControlNumber("Минимальный рейтинг: ",minRatingValue,"0.1","4.0","5.0",updateMinRatingInput,controlStyle,numberInputStyle);const noRatingDiv=createFilterControlCheckbox("Без рейтинга: ",noRatingChecked,updateNoRatingInput,controlStyle,checkboxInputStyle);filtersContainer.append(minRatingDiv);filtersContainer.append(noRatingDiv);parentNode.prepend(filtersContainer)}function updateMinRatingInput(e){minRatingValue=updateValue(e,MIN_RATING_LOCAL_STORAGE_KEY,false)}function updateNoRatingInput(e){noRatingChecked=updateValue(e,NO_RATING_LOCAL_STORAGE_KEY,false)}function cleanList(){const productCards=getAllElements(document,PRODUCT_CARD_SELECTOR);productCards.forEach((productCard=>{const productCardRating=getFirstElement(productCard,PRODUCT_CARD_RATING_SELECTOR);if(!productCardRating){noRatingChecked?showElement(productCard):hideElement(productCard);return}const productCardRatingNumber=getElementInnerNumber(productCardRating);productCardRatingNumber<minRatingValue?hideElement(productCard):showElement(productCard)}))}})();