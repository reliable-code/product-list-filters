// ==UserScript==
// @name         Prodoctorov List Clean
// @description  Remove profile cards by filter
// @match        https://prodoctorov.ru/*
// @namespace    https://github.com/reliable-code/product-list-filters
// @version      0.4.69633151
// @icon         https://www.google.com/s2/favicons?sz=64&domain=prodoctorov.ru
// @author       reliable-code
// ==/UserScript==

(()=>{"use strict";function insertAfter(existingNode,newNode){existingNode.parentNode.insertBefore(newNode,existingNode.nextSibling)}function updateInput(keyName,e){localStorage.setItem(keyName,e.target.value);window.location.reload()}function createDefaultFilterControl(titleText,inputValue,inputStep,inputMinValue,inputMaxValue,inputOnChange,controlStyle="",inputStyle=""){const filterControl=document.createElement("div");filterControl.style=controlStyle;filterControl.textContent=titleText;const input=document.createElement("input");input.style=inputStyle;input.type="number";input.value=inputValue;input.step=inputStep;input.min=inputMinValue;input.max=inputMaxValue;input.addEventListener("change",inputOnChange);filterControl.appendChild(input);return filterControl}


const MIN_REVIEWS_LOCAL_STORAGE_KEY="minReviewsFilter";const APPOINTMENTS_PAGE=".appointments_page";const SPECIAL_PLACEMENT_CARD_SELECTOR=".b-doctor-card_special-placement";const MIN_REVIEWS_DIV_ID="minReviewsDiv";const DOCTOR_CARD_SELECTOR=".b-doctor-card";const DOCTOR_CARD_NAME_SELECTOR=".b-doctor-card__name-surname";const MIN_REVIEWS=10;const minReviewsValue=+(localStorage.getItem(MIN_REVIEWS_LOCAL_STORAGE_KEY)??MIN_REVIEWS);const appointmentsPage=document.querySelector(APPOINTMENTS_PAGE);if(appointmentsPage){initListClean();setInterval(checkListCleanInitiated,500)}function initListClean(){const minReviewsDiv=createDefaultFilterControl("Минимально отзывов: ",minReviewsValue,"1","1","999999",updateMinReviewsInput);minReviewsDiv.id=MIN_REVIEWS_DIV_ID;insertAfter(appointmentsPage,minReviewsDiv);removeSpecialPlacementCards();cleanList()}function updateMinReviewsInput(e){updateInput(MIN_REVIEWS_LOCAL_STORAGE_KEY,e)}function removeSpecialPlacementCards(){const specialPlacementCards=document.querySelectorAll(SPECIAL_PLACEMENT_CARD_SELECTOR);specialPlacementCards.forEach((specialPlacementCard=>specialPlacementCard.remove()))}function cleanList(){const doctorCards=appointmentsPage.querySelectorAll(DOCTOR_CARD_SELECTOR);doctorCards.forEach((doctorCard=>{const profileCard=doctorCard.querySelector(".b-profile-card");if(!profileCard)return;const reviewsLink=profileCard.querySelector(":scope > a");if(!reviewsLink){doctorCard.remove();return}const reviewsLinkText=reviewsLink.innerText;const reviewsLinkDigit=+reviewsLinkText.replace(/\D/g,"");reviewsLinkDigit<minReviewsValue&&doctorCard.remove();appendAdditionalLinks(doctorCard,profileCard)}))}function appendAdditionalLinks(doctorCard,profileCard){appendAdditionalLink(doctorCard,profileCard,"НаПоправку");appendAdditionalLink(doctorCard,profileCard,"DocDoc");appendAdditionalLink(doctorCard,profileCard,"ДОКТУ")}function appendAdditionalLink(doctorCard,profileCard,siteName){const doctorCardName=doctorCard.querySelector(DOCTOR_CARD_NAME_SELECTOR);const doctorName=doctorCardName.innerText;const searchString=`${doctorName} ${siteName}`;const encodedSearchString=encodeURIComponent(searchString);const lineBreak=document.createElement("br");profileCard.appendChild(lineBreak);const searchUrlLink=document.createElement("a");searchUrlLink.href=`http://www.google.com/search?q=${encodedSearchString}&btnI`;searchUrlLink.textContent=siteName;profileCard.appendChild(searchUrlLink)}function checkListCleanInitiated(){const minReviewsDiv=appointmentsPage.querySelector(`#${MIN_REVIEWS_DIV_ID}`);minReviewsDiv||initListClean()}})();