// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/product-list-filters
// @version      1.0.73903091
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// ==/UserScript==

(()=>{(()=>{"use strict";var V={5467:(x,a,t)=>{t.d(a,{E2:()=>v});var y=t(9928);function v(g,o={},e=null){const r=(0,y.Sw)(o,e);return r.append(g),r}function b(g,o=null,e={},r={}){const s=createActionLink(g,o,r);return v(s,e)}function f(g,o=null,e=null,r={},s={}){const w=createActionLinkWithIcon(g,e,o,s);return v(w,r)}},9928:(x,a,t)=>{t.d(a,{S:()=>g,Sw:()=>F,o5:()=>f});var y=t(4921),v=t(5539);function b(c,m,N){const p=o(c,"text",m);return p.value=N,p}function f(c,m,N,p,O,d){const l=o(c,"number",m);return l.value=N,l.step=p,l.min=O,l.max=d,l}function g(c,m,N){const p=o(c,"checkbox",m);return p.checked=N,p}function o(c={},m=null,N=null){const p=C("input",c);return m&&(p.type=m),N&&(p.addEventListener("keyup",(0,y.sg)(N,200)),p.addEventListener("change",(0,y.sg)(N,100))),p}function e(c={},m=null){return C("span",c,m)}function r(c={},m=null,N=null){const p=C("a",c,m);return N&&(p.href=N),p}function s(c,m=null,N={}){N.cursor||="pointer";const p=r(N,m);return c&&p.addEventListener("click",c),p}function w(c,m,N=null,p={},O={}){p.display||="inline-flex",p.alignItems||="center",p.gap||="0.25em";const d=s(c,N,p);return d.prepend(h(m,O)),d}function S(c={},m=null,N=null){const p=C("button",c,m);return N&&p.addEventListener("click",N),p}function F(c={},m=null){return C("div",c,m)}function i(c={}){return C("i",c)}function h(c,m={}){m.width||="1em",m.height||="1em",m.paddingBottom||="1px";const N=i(m);return N.setAttribute("data-lucide",c),N}function C(c,m,N=null){if(typeof m!="object"||m===null)throw new TypeError("styles should be an object");const p=document.createElement(c);return(0,v.ZM)(p,m),N&&(p.innerHTML=N),p}},573:(x,a,t)=>{t.d(a,{Fi:()=>v,fI:()=>b});function y(i,h=document){return!!h.querySelector(i)}function v(i,h=document,C=!1){const c=h.querySelector(i);return C&&!c&&console.log(`No element found for selector: ${i}`),c}function b(i,h=document,C=!1){const c=h.querySelectorAll(i);return C&&!c.length&&console.log(`No elements found for selector: ${i}`),c}function f(i,h,C){return[...i.querySelectorAll(h)].find(c=>c.textContent.trim().includes(C))}function g(i,h,C=!1,c=!1){const m=v(h,i,!0);return o(m,C,c)}function o(i,h=!1,C=!1,c=null){if(!i)return c===null?(console.log("No element found"),null):c;const m=i.innerText;return s(m,h,C)}function e(i,h,C=!1){const c=i[h];return o(c,C)}function r(i,h=!1,C=!1){const c=i.textContent;return s(c,h,C)}function s(i,h,C){h&&(i=removeNonNumber(i)),C&&(i=i.replace(",","."));const c=Number(i);return Number.isNaN(c)?(console.log(`Invalid number: ${i}`),0):c}function w(i){return[...i.childNodes].find(h=>h.nodeType===Node.TEXT_NODE)}function S(i){const h=C=>C.nodeType===Node.TEXT_NODE&&C.textContent.trim()!==""?[C]:[...C.childNodes].flatMap(h);return h(i)}function F(i){return normalizeSpacing(i.textContent)}},5539:(x,a,t)=>{t.d(a,{Bt:()=>v,ZM:()=>k,kl:()=>g});function y(n,E){n.parentNode.insertBefore(E,n.nextSibling)}function v(n){n.style.display="none"}function b(n){w(n),v(n)}function f(n){n.intersectionObserver||runOnceOnIntersection(n,()=>v(n))}function g(n){n.style.display=""}function o(n){const E=s(n);n.style.display=E}function e(n,E){E?v(n):g(n)}function r(n,E){E?f(n):(clearIntersectionObserver(n),g(n))}function s(n){return w(n),n.defaultDisplay}function w(n){if(n.defaultDisplay)return;const{display:E}=getComputedStyle(n);n.defaultDisplay=E}function S(){return{show:[],hide:[]}}function F(n,E,I){n?E.hide.push(I):E.show.push(I)}function i(n){n.show.forEach(g),n.hide.forEach(v)}function h(n,E,I=.3){E?c(n,I):C(n)}function C(n){n.style.opacity=""}function c(n,E=.3){n.style.opacity=E}function m(n){n.style.order=""}function N(n,E){n.style.order=E}function p(n,E){n.style.background=E}function O(n,E){const I=getFirstElement(E);if(!I)return;const A=createLink();A.href=n,I.parentNode.append(A),A.append(I)}function d(n,E){const I=getFirstElement(E);I&&l(n,I)}function l(n,E){const I=createLink();I.href=n,I.append(...E.childNodes),E.append(I)}function u(){const n=getURLQueryParam("scrollTo");if(!n)return;const E=document.getElementById(n);E?E.scrollIntoView():console.log(`Element with ID "${n}" was not found.`)}function T(n,E="custom-global-style"){let I=document.getElementById(E);I||(I=document.createElement("style"),I.id=E,I.type="text/css",document.head.appendChild(I)),I.textContent=n}function k(n,E){Object.assign(n.style,E)}function M(n){return Object.entries(n).map(([E,I])=>`${E.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${I};`).join(" ")}function _(n){return n?n.split(";").filter(E=>E.trim()!=="").reduce((E,I)=>{const[A,R]=I.split(":").map(B=>B.trim()),D=A.replace(/-([a-z])/g,(B,U)=>U.toUpperCase());return E[D]=R,E},{}):{}}function W(n,E,I="text/plain"){const A=new Blob([n],{type:I}),R=URL.createObjectURL(A),D=document.createElement("a");D.href=R,D.download=E,document.body.appendChild(D),D.click(),document.body.removeChild(D),requestAnimationFrame(()=>URL.revokeObjectURL(R))}},4921:(x,a,t)=>{t.d(a,{sg:()=>f,xk:()=>y});function y(e,r,s=null){const w=e.querySelector(r);return w?Promise.resolve(w):new Promise(S=>{const F=new MutationObserver(h);F.observe(e,{childList:!0,subtree:!0});let i;s&&(i=setTimeout(()=>{F.disconnect(),console.log(`No element found for selector: ${r}`),S(null)},s));function h(){const C=e.querySelector(r);C&&(i&&clearTimeout(i),F.disconnect(),S(C))}})}function v(e,r){return e.querySelector(r)?new Promise(w=>{const S=new MutationObserver(F);S.observe(e,{childList:!0,subtree:!0});function F(){e.querySelector(r)||(S.disconnect(),w())}}):Promise.resolve()}function b(e,r=400){return new Promise(s=>{let w;const S=new MutationObserver(()=>{clearTimeout(w),F()});function F(){w=setTimeout(()=>{S.disconnect(),s()},r)}F(),S.observe(e,{childList:!0,subtree:!0})})}function f(e,r=250){let s;return(...w)=>{clearTimeout(s),s=setTimeout(()=>e(...w),r)}}function g(e,r){const s=new IntersectionObserver(w=>{w.forEach(S=>{S.isIntersecting&&(r(),o(e))})});e.intersectionObserver=s,s.observe(e)}function o(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(x,a,t)=>{t.d(a,{JE:()=>b});function y(o,e){return!v(o,e)}function v(o,e){if(!e.value)return!0;const r=o.toLowerCase(),s=getSearchStrings(e),w=[],S=[];return s.forEach(F=>{if(F.startsWith("!")){const i=F.substring(1);i&&S.push(i)}else w.push(F)}),w.every(F=>r.includes(F))&&S.every(F=>!r.includes(F))}function b(o,e){return e.value!=null&&o<e.value}function f(o,e){return e.value!=null&&o>e.value}function g(o,e){return e.value&&o!==e.value}},4521:(x,a,t)=>{t.d(a,{z:()=>v});var y=t(3048);function v(b,f=null){return{createGlobalFilter(g,o=null,e=b){return y.V.create(g,o,e)},createSectionFilter(g,o=null,e=b){if(!f)throw new Error("sectionId must be provided to use createSectionFilter.");return y.V.createWithCompositeKey(f,g,o,e)}}}},5884:(x,a,t)=>{t.d(a,{Hw:()=>g,nW:()=>f});var y=t(9928),v=t(5467);function b(o,e,r={},s={}){const w=createTextInput(s,e.updateValueFromEvent,e.value);return createControl(w,r,o)}function f(o,e,r,s,w,S={},F={}){const i=(0,y.o5)(F,e.updateValueFromEvent,e.value,r,s,w);return(0,v.E2)(i,S,o)}function g(o,e,r={},s={}){const w=(0,y.S)(s,e.updateValueFromEvent,e.value);return(0,v.E2)(w,r,o)}},7877:(x,a,t)=>{t.d(a,{aW:()=>h,pW:()=>O});var y=t(5884);function v(d,l={},u={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",d,l,u)}function b(d,l={},u={},T=.1,k=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",d,T,k,5,l,u)}function f(d,l={},u={},T=.1,k=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",d,T,k,5,l,u)}function g(d,l={},u={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",d,l,u)}function o(d,l={},u={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",d,l,u)}function e(d,l,u={},T={}){return createNumberFilterControl(d,l,"1","1","999999",u,T)}function r(d,l={},u={}){return s("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",d,l,u)}function s(d,l,u={},T={}){return createNumberFilterControl(d,l,"5","0","100",u,T)}function w(d,l={},u={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",d,"5","0","100",l,u)}function S(d,l,u={},T={},k="250"){return createNumberFilterControl(d,l,k,"0","1000000",u,T)}function F(d,l={},u={},T="25"){return S("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",d,l,u,T)}function i(d,l={},u={},T="25"){return S("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",d,l,u,T)}function h(d,l={},u={}){return C("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",d,l,u)}function C(d,l,u={},T={}){return(0,y.nW)(d,l,"1","0","99999",u,T)}function c(d,l={},u={}){return createNumberFilterControl("\u041A\u043E\u043B\u043E\u043D\u043E\u043A: ",d,"1","2","6",l,u)}function m(d,l={},u={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",d,l,u)}function N(d,l={},u={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",d,l,u)}function p(d,l={},u={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",d,l,u)}function O(d,l={},u={}){return(0,y.Hw)("\u0412\u043A\u043B: ",d,l,u)}},5213:(x,a,t)=>{t.d(a,{b:()=>b});var y=t(9928),v=t(573);function b(f,g,o=!1,e="customFiltersContainer"){let r=(0,v.Fi)(`#${e}`,f);if(r)if(o)r.remove();else return;r=(0,y.Sw)(),r.id=e,g(r,f)}},8200:(x,a,t)=>{t.d(a,{s:()=>y});function y(v){const{target:b}=v,{type:f}=b;switch(f){case"text":return`"${b.value}"`;case"number":return b.value;case"checkbox":return b.checked;default:return console.log(`Unknown input type: ${f}`),null}}},157:(x,a,t)=>{t.d(a,{Fg:()=>y,vx:()=>b});const y=window.GM_setValue,v=window.GM.setValue,b=window.GM_getValue,f=window.GM_addValueChangeListener},1870:(x,a,t)=>{t.d(a,{j:()=>y});class y{constructor(b,f){this.value=b,this.onChange=f}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(x,a,t)=>{t.d(a,{V:()=>g});var y=t(1870),v=t(8200),b=t(3976),f=t(157);class g extends y.j{constructor(e,r=null,s=null){super((0,f.vx)(e,r),s),this.storageKey=e,this.defaultValue=r}static create(e,r=null,s=null){return new g(e,r,s)}static createWithCompositeKey(e,r,s=null,w=null){const S=`${e}-${r}`;return new g(S,s,w)}updateValueFromEvent=e=>{const r=(0,v.s)(e),s=(0,b.$)(r);this.updateValue(s)};updateValue(e,r=!0){this.value!==e&&((0,f.Fg)(this.storageKey,e),this.value=e,r&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(x,a,t)=>{t.d(a,{$:()=>y});function y(v){return v===""?null:JSON.parse(v)}},6213:(x,a,t)=>{t.a(x,async(y,v)=>{try{let N=function(u,T){(0,b.ZM)(u,e.r.FILTERS_CONTAINER);const k=(0,g.aW)(i,e.r.CONTROL,e.r.NUMBER_INPUT),M=(0,g.pW)(h,e.r.CONTROL,e.r.CHECKBOX_INPUT);u.append(k,M),T.append(u)},p=function(){(0,f.fI)(o.Z.COMMENTS).forEach(O)},O=function(u){if(!h.value){l(u);return}let T=C.commentsCache.get(u);if(!T){const M=(0,f.Fi)(o.Z.RATING_WRAP,u);if(!M)return;const _=M.innerText.trim();if(_==="")return;T={rating:+_},C.commentsCache.set(u,T)}(0,w.JE)(T.rating,i)?d(u):l(u)},d=function(u){(0,b.Bt)(u);const T=u.parentElement;T&&[...T.children].every(k=>k.style.display==="none")&&d(T)},l=function(u){(0,b.kl)(u);const T=u.parentElement;T&&T.style.display==="none"&&l(T)};var b=t(5539),f=t(573),g=t(7877),o=t(1719),e=t(9175),r=t(4521),s=t(5213),w=t(3829),S=t(4921);const{createGlobalFilter:F}=(0,r.z)(p),i=F("min-rating-filter",4),h=F("filter-enabled",!0),C={commentsCache:new WeakMap};await c();async function c(){const u=await(0,S.xk)(document,o.Z.COMMENTS_TREE);new MutationObserver(m).observe(u,{childList:!0,subtree:!0})}async function m(){const u=await(0,S.xk)(document,o.Z.COMMENTS_HEADER);(0,s.b)(u,N),p()}v()}catch(F){v(F)}},1)},1719:(x,a,t)=>{t.d(a,{Z:()=>y});const y={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(x,a,t)=>{t.d(a,{r:()=>v});const v={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},P={};function L(x){var a=P[x];if(a!==void 0)return a.exports;var t=P[x]={exports:{}};return V[x](t,t.exports,L),t.exports}(()=>{var x=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",a=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=b=>{b&&b.d<1&&(b.d=1,b.forEach(f=>f.r--),b.forEach(f=>f.r--?f.r++:f()))},v=b=>b.map(f=>{if(f!==null&&typeof f=="object"){if(f[x])return f;if(f.then){var g=[];g.d=0,f.then(r=>{o[a]=r,y(g)},r=>{o[t]=r,y(g)});var o={};return o[x]=r=>r(g),o}}var e={};return e[x]=r=>{},e[a]=f,e});L.a=(b,f,g)=>{var o;g&&((o=[]).d=-1);var e=new Set,r=b.exports,s,w,S,F=new Promise((i,h)=>{S=h,w=i});F[a]=r,F[x]=i=>(o&&i(o),e.forEach(i),F.catch(h=>{})),b.exports=F,f(i=>{s=v(i);var h,C=()=>s.map(m=>{if(m[t])throw m[t];return m[a]}),c=new Promise(m=>{h=()=>m(C),h.r=0;var N=p=>p!==o&&!e.has(p)&&(e.add(p),p&&!p.d&&(h.r++,p.push(h)));s.map(p=>p[x](N))});return h.r?c:C()},i=>(i?S(F[t]=i):w(r),y(o))),o&&o.d<0&&(o.d=0)}})(),L.d=(x,a)=>{for(var t in a)L.o(a,t)&&!L.o(x,t)&&Object.defineProperty(x,t,{enumerable:!0,get:a[t]})},L.o=(x,a)=>Object.prototype.hasOwnProperty.call(x,a);var $=L(6213)})();})();
