// ==UserScript==
// @name         Habr comments filter
// @description  Hide comments by filter
// @grant        GM_addValueChangeListener
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://habr.com/*
// @namespace    https://github.com/reliable-code/product-list-filters
// @version      1.0.73877098
// @icon         https://www.google.com/s2/favicons?sz=64&domain=habr.com
// @author       reliable-code
// ==/UserScript==

(()=>{(()=>{"use strict";var V={5467:(S,c,t)=>{t.d(c,{E2:()=>v});var y=t(9928);function v(g,o={},e=null){const r=(0,y.Sw)(o,e);return r.append(g),r}function b(g,o=null,e={},r={}){const a=createActionLink(g,o,r);return v(a,e)}function s(g,o=null,e=null,r={},a={}){const F=createActionLinkWithIcon(g,e,o,a);return v(F,r)}},9928:(S,c,t)=>{t.d(c,{S:()=>g,Sw:()=>x,o5:()=>s});var y=t(4921),v=t(5539);function b(i,f,T){const d=o(i,"text",f);return d.value=T,d}function s(i,f,T,d,p,E){const l=o(i,"number",f);return l.value=T,l.step=d,l.min=p,l.max=E,l}function g(i,f,T){const d=o(i,"checkbox",f);return d.checked=T,d}function o(i={},f=null,T=null){const d=C("input",i);return f&&(d.type=f),T&&(d.addEventListener("keyup",(0,y.sg)(T,200)),d.addEventListener("change",(0,y.sg)(T,100))),d}function e(i={},f=null){return C("span",i,f)}function r(i={},f=null,T=null){const d=C("a",i,f);return T&&(d.href=T),d}function a(i,f=null,T={}){T.cursor||="pointer";const d=r(T,f);return i&&d.addEventListener("click",i),d}function F(i,f,T=null,d={}){d.display||="inline-flex",d.alignItems||="center",d.gap||="0.25em";const p=a(i,T,d);return p.prepend(h(f)),p}function N(i={},f=null,T=null){const d=C("button",i,f);return T&&d.addEventListener("click",T),d}function x(i={},f=null){return C("div",i,f)}function u(i={}){return C("i",i)}function h(i,f={}){f.width||="1em",f.height||="1em",f.paddingBottom||="1px";const T=u(f);return T.setAttribute("data-lucide",i),T}function C(i,f,T=null){if(typeof f!="object"||f===null)throw new TypeError("styles should be an object");const d=document.createElement(i);return(0,v.ZM)(d,f),T&&(d.innerHTML=T),d}},573:(S,c,t)=>{t.d(c,{Fi:()=>v,fI:()=>b});function y(u,h=document){return!!h.querySelector(u)}function v(u,h=document,C=!1){const i=h.querySelector(u);return C&&!i&&console.log(`No element found for selector: ${u}`),i}function b(u,h=document,C=!1){const i=h.querySelectorAll(u);return C&&!i.length&&console.log(`No elements found for selector: ${u}`),i}function s(u,h,C){return[...u.querySelectorAll(h)].find(i=>i.textContent.trim().includes(C))}function g(u,h,C=!1,i=!1){const f=v(h,u,!0);return o(f,C,i)}function o(u,h=!1,C=!1,i=null){if(!u)return i===null?(console.log("No element found"),null):i;const f=u.innerText;return a(f,h,C)}function e(u,h,C=!1){const i=u[h];return o(i,C)}function r(u,h=!1,C=!1){const i=u.textContent;return a(i,h,C)}function a(u,h,C){h&&(u=removeNonNumber(u)),C&&(u=u.replace(",","."));const i=Number(u);return Number.isNaN(i)?(console.log(`Invalid number: ${u}`),0):i}function F(u){return[...u.childNodes].find(h=>h.nodeType===Node.TEXT_NODE)}function N(u){const h=C=>C.nodeType===Node.TEXT_NODE&&C.textContent.trim()!==""?[C]:[...C.childNodes].flatMap(h);return h(u)}function x(u){return normalizeSpacing(u.textContent)}},5539:(S,c,t)=>{t.d(c,{Bt:()=>v,ZM:()=>D,kl:()=>g});function y(n,m){n.parentNode.insertBefore(m,n.nextSibling)}function v(n){n.style.display="none"}function b(n){F(n),v(n)}function s(n){n.intersectionObserver||runOnceOnIntersection(n,()=>v(n))}function g(n){n.style.display=""}function o(n){const m=a(n);n.style.display=m}function e(n,m){m?v(n):g(n)}function r(n,m){m?s(n):(clearIntersectionObserver(n),g(n))}function a(n){return F(n),n.defaultDisplay}function F(n){if(n.defaultDisplay)return;const{display:m}=getComputedStyle(n);n.defaultDisplay=m}function N(){return{show:[],hide:[]}}function x(n,m,k){n?m.hide.push(k):m.show.push(k)}function u(n){n.show.forEach(g),n.hide.forEach(v)}function h(n,m,k=.3){m?i(n,k):C(n)}function C(n){n.style.opacity=""}function i(n,m=.3){n.style.opacity=m}function f(n){n.style.order=""}function T(n,m){n.style.order=m}function d(n,m){n.style.background=m}function p(n,m){const k=getFirstElement(m);if(!k)return;const L=createLink();L.href=n,k.parentNode.append(L),L.append(k)}function E(n,m){const k=getFirstElement(m);k&&l(n,k)}function l(n,m){const k=createLink();k.href=n,k.append(...m.childNodes),m.append(k)}function w(){const n=getURLQueryParam("scrollTo");if(!n)return;const m=document.getElementById(n);m?m.scrollIntoView():console.log(`Element with ID "${n}" was not found.`)}function I(n,m="custom-global-style"){let k=document.getElementById(m);k||(k=document.createElement("style"),k.id=m,k.type="text/css",document.head.appendChild(k)),k.textContent=n}function D(n,m){Object.assign(n.style,m)}function A(n){return Object.entries(n).map(([m,k])=>`${m.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${k};`).join(" ")}function _(n){return n?n.split(";").filter(m=>m.trim()!=="").reduce((m,k)=>{const[L,R]=k.split(":").map(B=>B.trim()),M=L.replace(/-([a-z])/g,(B,U)=>U.toUpperCase());return m[M]=R,m},{}):{}}function W(n,m,k="text/plain"){const L=new Blob([n],{type:k}),R=URL.createObjectURL(L),M=document.createElement("a");M.href=R,M.download=m,document.body.appendChild(M),M.click(),document.body.removeChild(M),requestAnimationFrame(()=>URL.revokeObjectURL(R))}},4921:(S,c,t)=>{t.d(c,{sg:()=>s,xk:()=>y});function y(e,r,a=null){const F=e.querySelector(r);return F?Promise.resolve(F):new Promise(N=>{const x=new MutationObserver(h);x.observe(e,{childList:!0,subtree:!0});let u;a&&(u=setTimeout(()=>{x.disconnect(),console.log(`No element found for selector: ${r}`),N(null)},a));function h(){const C=e.querySelector(r);C&&(u&&clearTimeout(u),x.disconnect(),N(C))}})}function v(e,r){return e.querySelector(r)?new Promise(F=>{const N=new MutationObserver(x);N.observe(e,{childList:!0,subtree:!0});function x(){e.querySelector(r)||(N.disconnect(),F())}}):Promise.resolve()}function b(e,r=400){return new Promise(a=>{let F;const N=new MutationObserver(()=>{clearTimeout(F),x()});function x(){F=setTimeout(()=>{N.disconnect(),a()},r)}x(),N.observe(e,{childList:!0,subtree:!0})})}function s(e,r=250){let a;return(...F)=>{clearTimeout(a),a=setTimeout(()=>e(...F),r)}}function g(e,r){const a=new IntersectionObserver(F=>{F.forEach(N=>{N.isIntersecting&&(r(),o(e))})});e.intersectionObserver=a,a.observe(e)}function o(e){e.intersectionObserver&&(e.intersectionObserver.disconnect(),e.intersectionObserver=null)}},3829:(S,c,t)=>{t.d(c,{JE:()=>b});function y(o,e){return!v(o,e)}function v(o,e){if(!e.value)return!0;const r=o.toLowerCase(),a=getSearchStrings(e),F=[],N=[];return a.forEach(x=>{if(x.startsWith("!")){const u=x.substring(1);u&&N.push(u)}else F.push(x)}),F.every(x=>r.includes(x))&&N.every(x=>!r.includes(x))}function b(o,e){return e.value!=null&&o<e.value}function s(o,e){return e.value!=null&&o>e.value}function g(o,e){return e.value&&o!==e.value}},4521:(S,c,t)=>{t.d(c,{z:()=>v});var y=t(3048);function v(b,s=null){return{createGlobalFilter(g,o=null,e=b){return y.V.create(g,o,e)},createSectionFilter(g,o=null,e=b){if(!s)throw new Error("sectionId must be provided to use createSectionFilter.");return y.V.createWithCompositeKey(s,g,o,e)}}}},5884:(S,c,t)=>{t.d(c,{Hw:()=>g,nW:()=>s});var y=t(9928),v=t(5467);function b(o,e,r={},a={}){const F=createTextInput(a,e.updateValueFromEvent,e.value);return createControl(F,r,o)}function s(o,e,r,a,F,N={},x={}){const u=(0,y.o5)(x,e.updateValueFromEvent,e.value,r,a,F);return(0,v.E2)(u,N,o)}function g(o,e,r={},a={}){const F=(0,y.S)(a,e.updateValueFromEvent,e.value);return(0,v.E2)(F,r,o)}},7877:(S,c,t)=>{t.d(c,{aW:()=>h,pW:()=>d});var y=t(5884);function v(p,E={},l={}){return createTextFilterControl("\u041F\u043E\u0438\u0441\u043A: ",p,E,l)}function b(p,E={},l={},w=.1,I=3){return createNumberFilterControl("\u041C\u0438\u043D. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",p,w,I,5,E,l)}function s(p,E={},l={},w=.1,I=3){return createNumberFilterControl("\u041C\u0430\u043A\u0441. \u0440\u0435\u0439\u0442\u0438\u043D\u0433: ",p,w,I,5,E,l)}function g(p,E={},l={}){return e("\u041C\u0438\u043D. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",p,E,l)}function o(p,E={},l={}){return e("\u041C\u0430\u043A\u0441. \u043E\u0442\u0437\u044B\u0432\u043E\u0432: ",p,E,l)}function e(p,E,l={},w={}){return createNumberFilterControl(p,E,"1","1","999999",l,w)}function r(p,E={},l={}){return a("\u041C\u0438\u043D. \u0441\u043A\u0438\u0434\u043A\u0430: ",p,E,l)}function a(p,E,l={},w={}){return createNumberFilterControl(p,E,"5","0","100",l,w)}function F(p,E={},l={}){return createNumberFilterControl("\u041C\u0438\u043D. \u043A\u0435\u0448\u0431\u0435\u043A: ",p,"5","0","100",E,l)}function N(p,E,l={},w={},I="250"){return createNumberFilterControl(p,E,I,"0","1000000",l,w)}function x(p,E={},l={},w="25"){return N("\u041C\u0438\u043D. \u0446\u0435\u043D\u0430: ",p,E,l,w)}function u(p,E={},l={},w="25"){return N("\u041C\u0430\u043A\u0441. \u0446\u0435\u043D\u0430: ",p,E,l,w)}function h(p,E={},l={}){return C("\u041C\u0438\u043D. \u043B\u0430\u0438\u0306\u043A\u043E\u0432: ",p,E,l)}function C(p,E,l={},w={}){return(0,y.nW)(p,E,"1","0","99999",l,w)}function i(p,E={},l={}){return createCheckboxFilterControl("\u0411\u0435\u0437 \u0440\u0435\u0439\u0442\u0438\u043D\u0433\u0430: ",p,E,l)}function f(p,E={},l={}){return createCheckboxFilterControl("\u0421 \u0444\u043E\u0442\u043E: ",p,E,l)}function T(p,E={},l={}){return createCheckboxFilterControl("\u041F\u0440\u043E\u0433\u0440\u0443\u0437\u043A\u0430: ",p,E,l)}function d(p,E={},l={}){return(0,y.Hw)("\u0412\u043A\u043B: ",p,E,l)}},5213:(S,c,t)=>{t.d(c,{b:()=>b});var y=t(9928),v=t(573);function b(s,g,o=!1,e="customFiltersContainer"){let r=(0,v.Fi)(`#${e}`,s);if(r)if(o)r.remove();else return;r=(0,y.Sw)(),r.id=e,g(r,s)}},8200:(S,c,t)=>{t.d(c,{s:()=>y});function y(v){const{target:b}=v,{type:s}=b;switch(s){case"text":return`"${b.value}"`;case"number":return b.value;case"checkbox":return b.checked;default:return console.log(`Unknown input type: ${s}`),null}}},157:(S,c,t)=>{t.d(c,{Fg:()=>y,vx:()=>b});const y=window.GM_setValue,v=window.GM.setValue,b=window.GM_getValue,s=window.GM_addValueChangeListener},1870:(S,c,t)=>{t.d(c,{j:()=>y});class y{constructor(b,s){this.value=b,this.onChange=s}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}},3048:(S,c,t)=>{t.d(c,{V:()=>g});var y=t(1870),v=t(8200),b=t(3976),s=t(157);class g extends y.j{constructor(e,r=null,a=null){super((0,s.vx)(e,r),a),this.storageKey=e,this.defaultValue=r}static create(e,r=null,a=null){return new g(e,r,a)}static createWithCompositeKey(e,r,a=null,F=null){const N=`${e}-${r}`;return new g(N,a,F)}updateValueFromEvent=e=>{const r=(0,v.s)(e),a=(0,b.$)(r);this.updateValue(a)};updateValue(e,r=!0){this.value!==e&&((0,s.Fg)(this.storageKey,e),this.value=e,r&&this.onChangeIfDefined())}clearValue(e=!1){this.updateValue(null,e)}resetValue(e=!1){this.updateValue(this.defaultValue,e)}}},3976:(S,c,t)=>{t.d(c,{$:()=>y});function y(v){return v===""?null:JSON.parse(v)}},6213:(S,c,t)=>{t.a(S,async(y,v)=>{try{let T=function(w,I){(0,b.ZM)(w,e.r.FILTERS_CONTAINER);const D=(0,g.aW)(u,e.r.CONTROL,e.r.NUMBER_INPUT),A=(0,g.pW)(h,e.r.CONTROL,e.r.CHECKBOX_INPUT);w.append(D,A),I.append(w)},d=function(){(0,s.fI)(o.Z.COMMENTS).forEach(p)},p=function(w){if(!h.value){l(w);return}let I=C.commentsCache.get(w);if(!I){const A=(0,s.Fi)(o.Z.RATING_WRAP,w);if(!A)return;const _=A.innerText.trim();if(_==="")return;I={rating:+_},C.commentsCache.set(w,I)}(0,F.JE)(I.rating,u)?E(w):l(w)},E=function(w){(0,b.Bt)(w);const I=w.parentElement;I&&[...I.children].every(D=>D.style.display==="none")&&E(I)},l=function(w){(0,b.kl)(w);const I=w.parentElement;I&&I.style.display==="none"&&l(I)};var b=t(5539),s=t(573),g=t(7877),o=t(1719),e=t(9175),r=t(4521),a=t(5213),F=t(3829),N=t(4921);const{createGlobalFilter:x}=(0,r.z)(d),u=x("min-rating-filter",4),h=x("filter-enabled",!0),C={commentsCache:new WeakMap};await i();async function i(){const w=await(0,N.xk)(document,o.Z.COMMENTS_TREE);new MutationObserver(f).observe(w,{childList:!0,subtree:!0})}async function f(){const w=await(0,N.xk)(document,o.Z.COMMENTS_HEADER);(0,a.b)(w,T),d()}v()}catch(x){v(x)}},1)},1719:(S,c,t)=>{t.d(c,{Z:()=>y});const y={COMMENTS_TREE:".tm-comments__tree",COMMENTS_HEADER:".tm-comments-wrapper__header",COMMENTS:".tm-comment-thread__comment:not(.process-passed)",RATING_WRAP:".tm-votes-lever__score-counter"}},9175:(S,c,t)=>{t.d(c,{r:()=>v});const v={FILTERS_CONTAINER:{display:"flex",gridGap:"12px",marginLeft:"28px"},CONTROL:{display:"flex",alignItems:"center",fontSize:"15px"},NUMBER_INPUT:{...{INPUT:{marginLeft:"6px",border:"1px solid #d9d9d9",borderRadius:"8px",padding:"7px 14px",fontSize:"15px"}}.INPUT,width:"35px"},CHECKBOX_INPUT:{marginLeft:"6px",width:"21px",height:"21px"}}}},P={};function O(S){var c=P[S];if(c!==void 0)return c.exports;var t=P[S]={exports:{}};return V[S](t,t.exports,O),t.exports}(()=>{var S=typeof Symbol=="function"?Symbol("webpack queues"):"__webpack_queues__",c=typeof Symbol=="function"?Symbol("webpack exports"):"__webpack_exports__",t=typeof Symbol=="function"?Symbol("webpack error"):"__webpack_error__",y=b=>{b&&b.d<1&&(b.d=1,b.forEach(s=>s.r--),b.forEach(s=>s.r--?s.r++:s()))},v=b=>b.map(s=>{if(s!==null&&typeof s=="object"){if(s[S])return s;if(s.then){var g=[];g.d=0,s.then(r=>{o[c]=r,y(g)},r=>{o[t]=r,y(g)});var o={};return o[S]=r=>r(g),o}}var e={};return e[S]=r=>{},e[c]=s,e});O.a=(b,s,g)=>{var o;g&&((o=[]).d=-1);var e=new Set,r=b.exports,a,F,N,x=new Promise((u,h)=>{N=h,F=u});x[c]=r,x[S]=u=>(o&&u(o),e.forEach(u),x.catch(h=>{})),b.exports=x,s(u=>{a=v(u);var h,C=()=>a.map(f=>{if(f[t])throw f[t];return f[c]}),i=new Promise(f=>{h=()=>f(C),h.r=0;var T=d=>d!==o&&!e.has(d)&&(e.add(d),d&&!d.d&&(h.r++,d.push(h)));a.map(d=>d[S](T))});return h.r?i:C()},u=>(u?N(x[t]=u):F(r),y(o))),o&&o.d<0&&(o.d=0)}})(),O.d=(S,c)=>{for(var t in c)O.o(c,t)&&!O.o(S,t)&&Object.defineProperty(S,t,{enumerable:!0,get:c[t]})},O.o=(S,c)=>Object.prototype.hasOwnProperty.call(S,c);var $=O(6213)})();})();
