// ==UserScript==
// @name         Ozon List Clean
// @description  Remove product cards by filter
// @grant        GM_setValue
// @grant        GM_getValue
// @match        https://www.ozon.ru/*
// @namespace    https://github.com/reliable-code/product-list-filters
// @version      1.3.70965617
// @icon         https://www.google.com/s2/favicons?sz=64&domain=ozon.ru
// @author       reliable-code
// ==/UserScript==

(()=>{"use strict";


const thumbsDownIcon='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">'+'<path d="M8 14V4M8 14L4 14V4.00002L8 4M8 14L13.1956 20.0615C13.6886 20.6367 14.4642 20.884 15.1992 20.7002L15.2467 20.6883C16.5885 20.3529 17.1929 18.7894 16.4258 17.6387L14 14H18.5604C19.8225 14 20.7691 12.8454 20.5216 11.6078L19.3216 5.60779C19.1346 4.67294 18.3138 4.00002 17.3604 4.00002L8 4" stroke="#001a3499" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>'+"</svg>";const heartStrikeDislikeIcon='<svg fill="#001a3499" width="16" height="16" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">'+'<path d="M417.84,448a15.94,15.94,0,0,1-11.35-4.72L40.65,75.26A16,16,0,0,1,63.35,52.7l365.83,368A16,16,0,0,1,417.84,448Z"/><path d="M364.92,80c-48.09,0-80,29.55-96.92,51-16.88-21.48-48.83-51-96.92-51a107.37,107.37,0,0,0-31,4.55L168,112c22.26,0,45.81,9,63.94,26.67a123,123,0,0,1,21.75,28.47,16,16,0,0,0,28.6,0,123,123,0,0,1,21.77-28.51C322.19,121,342.66,112,364.92,112c43.15,0,78.62,36.33,79.07,81,.54,53.69-22.75,99.55-57.38,139.52l22.63,22.77c3-3.44,5.7-6.64,8.14-9.6,40-48.75,59.15-98.8,58.61-153C475.37,130.52,425.54,80,364.92,80Z"/><path d="M268,432C180.38,372.51,91,297.6,92,193a83.69,83.69,0,0,1,2.24-18.39L69,149.14a115.1,115.1,0,0,0-9,43.49c-.54,54.22,18.63,104.27,58.61,153,18.77,22.87,52.8,59.45,131.39,112.8a31.84,31.84,0,0,0,36,0c20.35-13.81,37.7-26.5,52.58-38.11l-22.66-22.81C300.25,409.6,284.09,421.05,268,432Z"/>'+"</svg>";function removeNonNumber(stringValue){return stringValue.replace(/[^\d.,-]/g,"")}function removeSpaces(stringValue){return stringValue.replace(/\s/g,"")}


function getFirstElement(selector,parentNode=document,logNotFound=false){const element=parentNode.querySelector(selector);logNotFound&&!element&&console.log(`No element found for selector: ${selector}`);return element}function getAllElements(selector,parentNode=document,logNotFound=false){const elements=parentNode.querySelectorAll(selector);logNotFound&&!elements.length&&console.log(`No elements found for selector: ${selector}`);return elements}function insertAfter(existingNode,newNode){existingNode.parentNode.insertBefore(newNode,existingNode.nextSibling)}function hideElement(element){setElementDisplay(element,"none")}function showElement(element,display="block"){setElementDisplay(element,display)}function showHideElement(element,conditionToHide,display="block"){conditionToHide?hideElement(element):showElement(element,display)}function setElementDisplay(element,display){element.style.display=display}function createTextInput(inputOnChange,inputStyle,inputValue){const input=createInput("text",inputOnChange,inputStyle);input.value=inputValue;return input}function createNumberInput(inputOnChange,inputStyle,inputValue,inputStep,inputMinValue,inputMaxValue){const input=createInput("number",inputOnChange,inputStyle);input.value=inputValue;input.step=inputStep;input.min=inputMinValue;input.max=inputMaxValue;return input}function createCheckboxInput(inputOnChange,inputStyle,isChecked){const input=createInput("checkbox",inputOnChange,inputStyle);input.checked=isChecked;return input}function createInput(type=null,inputOnChange=null,style=null){const input=document.createElement("input");type&&(input.type=type);if(inputOnChange){input.addEventListener("keyup",debounce(inputOnChange,200));input.addEventListener("change",debounce(inputOnChange,100))}style&&(input.style=style);return input}function createDiv(textContent=null,style=null){const div=document.createElement("div");textContent&&(div.textContent=textContent);style&&(div.style=style);return div}function createSpan(textContent=null,style=null){const span=document.createElement("span");textContent&&(span.textContent=textContent);style&&(span.style=style);return span}function createLink(href=null,innerHTML=null,style=null){const link=document.createElement("a");href&&(link.href=href);innerHTML&&(link.innerHTML=innerHTML);style&&(link.style=style);return link}function getElementInnerNumber(element,cleanText=false,replaceComma=false){const elementText=element.innerText;return parseNumber(elementText,cleanText,replaceComma)}function getArrayElementInnerNumber(array,elementIndex,cleanText=false){const element=array[elementIndex];const elementNumber=getElementInnerNumber(element,cleanText);return elementNumber}function getNodeInnerNumber(node,cleanText=false,replaceComma=false){const nodeText=node.textContent;return parseNumber(nodeText,cleanText,replaceComma)}function parseNumber(text,cleanText,replaceComma){cleanText&&(text=removeNonNumber(text));replaceComma&&(text=text.replace(",","."));const number=+text;return number}function waitForElement(parentNode,selector,timeout=null){return new Promise((resolve=>{const observer=new MutationObserver(mutationCallback);observer.observe(parentNode,{childList:true,subtree:true});let timeoutId=null;timeout&&(timeoutId=setTimeout((()=>{observer.disconnect();console.log(`No element found for selector: ${selector}`);resolve(null)}),timeout));function mutationCallback(){if(parentNode.querySelector(selector)){timeoutId&&clearTimeout(timeoutId);observer.disconnect();resolve(parentNode.querySelector(selector))}}}))}function debounce(func,wait=250){let timeoutId;return(...args)=>{clearTimeout(timeoutId);timeoutId=setTimeout((()=>func(...args)),wait)}}function addGlobalStyle(css){const style=document.createElement("style");style.type="text/css";style.textContent=css;document.head.appendChild(style)}function dom_getInputValueFromEvent(event){const{target}=event;const{type}=target;switch(type){case"text":return`"${target.value}"`;case"number":return target.value;case"checkbox":return target.checked;default:console.log(`Unknown input type: ${type}`);return null}}class dom_InputValueBase{constructor(value,onChange){this.value=value;this.onChange=onChange}onChangeIfDefined=()=>{this.onChange&&this.onChange()}}function dom_parseValue(value){return value===""?null:JSON.parse(value)}


const storage=localStorage;function getStorageValueOrDefault(key,defaultValue=null){const localStorageItem=storage.getItem(key);return localStorageItem===null?defaultValue:dom_parseValue(localStorageItem)}/* unused pure expression or super */null&&InputValueBase;


const setStorageValue=window.GM_setValue;const getStorageValue=window.GM_getValue;class storage_StoredInputValue extends dom_InputValueBase{constructor(storageKey,defaultValue=null,onChange=null){super(getStorageValue(storageKey,defaultValue),onChange);this.storageKey=storageKey}updateValueFromEvent=event=>{const newValue=dom_getInputValueFromEvent(event);const newParsedValue=dom_parseValue(newValue);if(this.value===newParsedValue)return;setStorageValue(this.storageKey,newParsedValue);this.value=newParsedValue;this.onChangeIfDefined()}}


function createFilterControlText(titleText,inputValue,controlStyle=null,inputStyle=null){const filterControl=createDiv(titleText,controlStyle);const input=createTextInput(inputValue.updateValueFromEvent,inputStyle,inputValue.value);filterControl.append(input);return filterControl}function createFilterControlNumber(titleText,inputValue,inputStep,inputMinValue,inputMaxValue,controlStyle=null,inputStyle=null){const filterControl=createDiv(titleText,controlStyle);const input=createNumberInput(inputValue.updateValueFromEvent,inputStyle,inputValue.value,inputStep,inputMinValue,inputMaxValue);filterControl.append(input);return filterControl}function createFilterControlCheckbox(titleText,inputValue,controlStyle=null,inputStyle=null){const filterControl=createDiv(titleText,controlStyle);const input=createCheckboxInput(inputValue.updateValueFromEvent,inputStyle,inputValue.value);filterControl.append(input);return filterControl}function createNameFilterControl(inputValue,controlStyle=null,inputStyle=null){return createFilterControlText("Содержит: ",inputValue,controlStyle,inputStyle)}function createMinRatingFilterControl(inputValue,controlStyle=null,inputStyle=null,inputStep=.1){return createFilterControlNumber("Мин. рейтинг: ",inputValue,inputStep,3,5,controlStyle,inputStyle)}function createMinReviewsFilterControl(inputValue,controlStyle=null,inputStyle=null){return createReviewsFilterControl("Мин. отзывов: ",inputValue,controlStyle,inputStyle)}function createMaxReviewsFilterControl(inputValue,controlStyle=null,inputStyle=null){return createReviewsFilterControl("Макс. отзывов: ",inputValue,controlStyle,inputStyle)}function createReviewsFilterControl(titleText,inputValue,controlStyle=null,inputStyle=null){return createFilterControlNumber(titleText,inputValue,"1","1","999999",controlStyle,inputStyle)}function createNoRatingFilterControl(inputValue,controlStyle=null,inputStyle=null){return createFilterControlCheckbox("Без рейтинга: ",inputValue,controlStyle,inputStyle)}function createEnabledFilterControl(inputValue,controlStyle=null,inputStyle=null){return createFilterControlCheckbox("Вкл: ",inputValue,controlStyle,inputStyle)}function appendFilterControlsIfNeeded(parentNode,appendFiltersContainerFunc,force=false,filtersContainerId="customFiltersContainer"){let filtersContainer=getFirstElement(`#${filtersContainerId}`,parentNode);if(filtersContainer){if(!force)return;filtersContainer.remove()}filtersContainer=createDiv();filtersContainer.id=filtersContainerId;appendFiltersContainerFunc(filtersContainer,parentNode)}function isNotMatchTextFilter(parameterValue,filter){return!isMatchTextFilter(parameterValue,filter)}function isMatchTextFilter(parameterValue,filter){if(!filter.value)return true;const comparedString=parameterValue.toLowerCase();const searchStrings=filter.value.toLowerCase().split(",").map((searchString=>searchString.trim()));const{include:includeSearchStrings,notInclude:notIncludeSearchStrings}=searchStrings.reduce(((result,searchString)=>{if(searchString.startsWith("!")){const notIncludeSearchString=searchString.substring(1);notIncludeSearchString.length&&result.notInclude.push(notIncludeSearchString)}else result.include.push(searchString);return result}),{include:[],notInclude:[]});return includeSearchStrings.every((searchString=>comparedString.includes(searchString)))&&notIncludeSearchStrings.every((searchString=>!comparedString.includes(searchString)))}function isLessThanFilter(parameterValue,filter){return filter.value&&parameterValue<filter.value}function isGreaterThanFilter(parameterValue,filter){return filter.value&&parameterValue>filter.value}


const PAGINATOR_CONTENT_SELECTOR="#paginatorContent";const PRODUCT_REVIEWS_WRAP_OLD_SELECTOR='[data-widget="webReviewProductScore"]';const PRODUCT_REVIEWS_WRAP_SELECTOR='[data-widget="webSingleProductScore"]';const COMMENTS_SELECTOR="#comments";const SEARCH_RESULTS_SORT_SELECTOR='[data-widget="searchResultsSort"]';const PRODUCT_CARDS_SELECTOR=".widget-search-result-container > div > div";const PRODUCT_CARD_NAME_SELECTOR=".tsBody500Medium";const PRODUCT_CARD_RATING_WRAP_SELECTOR=".tsBodyMBold";const CREATE_REVIEW_BUTTON_SELECTOR='[data-widget="createReviewButton"]';const CATEGORY_NAME=getCategoryName();const nameFilter=new storage_StoredInputValue(`${CATEGORY_NAME}-name-filter`,null,cleanList);const minReviewsFilter=new storage_StoredInputValue(`${CATEGORY_NAME}-min-reviews-filter`,null,cleanList);const maxReviewsFilter=new storage_StoredInputValue(`${CATEGORY_NAME}-max-reviews-filter`,null,cleanList);const minRatingFilter=new storage_StoredInputValue(`${CATEGORY_NAME}-min-rating-filter`,4.8,cleanList);const noRatingFilter=new storage_StoredInputValue(`${CATEGORY_NAME}-no-rating-filter`,false,cleanList);const filterEnabled=new storage_StoredInputValue(`${CATEGORY_NAME}-filter-enabled`,true,cleanList);function getCategoryName(){const{pathname}=window.location;const pathElements=pathname.split("/");const fullCategoryName=pathElements[2];if(!fullCategoryName)return"common";const categoryName=fullCategoryName.split("-").at(-1);return categoryName}function getProductArticleFromPathname(){const{pathname}=window.location;return getProductArticleFromUrl(pathname)}function getProductArticleFromUrl(pathname){const pathElements=pathname.split("/");const productLinkName=pathElements[2];if(!productLinkName){console.log("No product article in path");return null}const productArticle=productLinkName.split("-").at(-1);return productArticle}const paginatorContent=getFirstElement(PAGINATOR_CONTENT_SELECTOR);const comments=getFirstElement(COMMENTS_SELECTOR);paginatorContent?initListClean():comments?comments.scrollIntoView():isFavoritesPage()?initAppendFavoritesStoredPriceValues():appendAdditionalProductPageControls();function initListClean(){waitForElement(document,SEARCH_RESULTS_SORT_SELECTOR).then((searchResultsSort=>{appendFilterControlsIfNeeded(searchResultsSort,appendFiltersContainer);window.addEventListener("storage",cleanList);const observer=new MutationObserver(debounce(cleanList,50));observer.observe(paginatorContent,{childList:true,subtree:true})}))}function appendFiltersContainer(filtersContainer,parentNode){addGlobalStyle("input[type=number]::-webkit-inner-spin-button,"+"input[type=number]::-webkit-outer-spin-button {"+"    -webkit-appearance: auto;"+"}");filtersContainer.style="display: flex;"+"grid-gap: 15px;"+"margin-top: 14px;";const controlStyle="display: flex;"+"align-items: center;";const inputStyle="margin-left: 5px;"+"border: 2px solid #b3bcc5;"+"border-radius: 6px;"+"padding: 6px 10px;";const textInputStyle=inputStyle+// eslint-disable-line prefer-template
"width: 190px;";const numberInputStyle=inputStyle+// eslint-disable-line prefer-template
"width: 90px;";const checkboxInputStyle="margin-left: 5px;"+"width: 25px;"+"height: 25px;";const nameFilterDiv=createNameFilterControl(nameFilter,controlStyle,textInputStyle);const minReviewsDiv=createMinReviewsFilterControl(minReviewsFilter,controlStyle,numberInputStyle);const maxReviewsDiv=createMaxReviewsFilterControl(maxReviewsFilter,controlStyle,numberInputStyle);const minRatingDiv=createMinRatingFilterControl(minRatingFilter,controlStyle,numberInputStyle);const noRatingDiv=createNoRatingFilterControl(noRatingFilter,controlStyle,checkboxInputStyle);const filterEnabledDiv=createEnabledFilterControl(filterEnabled,controlStyle,checkboxInputStyle);filtersContainer.append(nameFilterDiv,minReviewsDiv,maxReviewsDiv,minRatingDiv,noRatingDiv,filterEnabledDiv);parentNode.append(filtersContainer);parentNode.style="position: sticky;"+"top: 62px;"+"background-color: #fff;"+"z-index: 2;"+"padding-bottom: 11px;"+"margin-bottom: 0;"+"gap: 15px;"}function cleanList(){const productCards=getAllElements(PRODUCT_CARDS_SELECTOR,paginatorContent);productCards.forEach((productCard=>{if(!filterEnabled.value){showElement(productCard,"flex");return}const productCardLink=getFirstElement("a",productCard);if(!productCardLink){hideElement(productCard);return}const productArticle=getProductArticleFromLink(productCardLink);const productCardNameWrap=getFirstElement(PRODUCT_CARD_NAME_SELECTOR,productCard);if(!productCardNameWrap){hideElement(productCard);return}const productCardRatingWrap=getFirstElement(PRODUCT_CARD_RATING_WRAP_SELECTOR,productCard);let productCardReviewsNumber;let productCardRatingNumber;if(productCardRatingWrap){const productCardRatingWrapSpans=getAllElements(":scope > span",productCardRatingWrap,true);productCardReviewsNumber=getArrayElementInnerNumber(productCardRatingWrapSpans,1,true);const storedRatingValue=getStoredRatingValue(productArticle);if(storedRatingValue){productCardRatingNumber=storedRatingValue;productCardRatingWrapSpans[0].children[1].textContent=storedRatingValue.toString().padEnd(5)}else productCardRatingNumber=getArrayElementInnerNumber(productCardRatingWrapSpans,0);appendProductDislikeButtonIfNeeded(productCardRatingWrap,productArticle)}else{const anyRatingFilterHasValue=minReviewsFilter.value||maxReviewsFilter.value||minRatingFilter.value;if(anyRatingFilterHasValue&&!noRatingFilter.value){hideElement(productCard);return}}const productCardName=productCardNameWrap.innerText;productCardNameWrap.title=productCardName;const conditionToHide=isNotMatchTextFilter(productCardName,nameFilter)||isLessThanFilter(productCardReviewsNumber,minReviewsFilter)||isGreaterThanFilter(productCardReviewsNumber,maxReviewsFilter)||isLessThanFilter(productCardRatingNumber,minRatingFilter);showHideElement(productCard,conditionToHide,"flex")}))}function appendProductDislikeButtonIfNeeded(productCardRatingWrap,productArticle){const productCardRatingWrapParent=productCardRatingWrap.parentNode;if(productCardRatingWrapParent.hasAttribute("dislikeButtonAdded"))return;productCardRatingWrapParent.style="display: flex; width: 100%";const dislikeButton=createDislikeButton((()=>dislikeProductOnProductList(productArticle)),false);productCardRatingWrapParent.append(dislikeButton);productCardRatingWrapParent.setAttribute("dislikeButtonAdded","")}function dislikeProductOnProductList(productArticle){setStoredRatingValue(productArticle,1);cleanList()}function createDislikeButton(onClick,needLabel=true){const productDislikeButton=createLink(null,heartStrikeDislikeIcon,"align-items: center; display: inline-flex; color: rgba(0, 26, 52, 0.6); cursor: pointer;");productDislikeButton.onclick=()=>{window.confirm("Выставить низкий рейтинг?")&&onClick()};if(needLabel){const productDislikeButtonSpan=createSpan("Дизлайк","padding-left: 8px;");productDislikeButton.append(productDislikeButtonSpan)}return productDislikeButton}function getProductArticleFromLink(productCardLink){const productCardLinkHref=productCardLink.getAttribute("href");return getProductArticleFromUrl(productCardLinkHref)}function isFavoritesPage(){return window.location.pathname.includes("favorites")}function appendAdditionalProductPageControls(){waitForElement(document,`${PRODUCT_REVIEWS_WRAP_OLD_SELECTOR}, ${PRODUCT_REVIEWS_WRAP_SELECTOR}`).then((productReviewsWrap=>{if(!productReviewsWrap)return;if(productReviewsWrap.matches(PRODUCT_REVIEWS_WRAP_OLD_SELECTOR)){appendDislikeButton(productReviewsWrap,true);appendBadReviewsLink(productReviewsWrap,true);appendRatingValue(getStarsContainerOld(productReviewsWrap))}else{appendDislikeButton(productReviewsWrap);appendBadReviewsLink(productReviewsWrap);appendRatingValue(getStarsContainer(productReviewsWrap))}}));initAppendPriceHistory();removeWebInstallmentPurchase();skipFirstGalleryVideo()}function appendDislikeButton(productReviewsWrap,isOld=false){const productDislikeButtonWrap=createDiv();let starsContainer;if(isOld){productDislikeButtonWrap.classList="tsBodyControl400Small";starsContainer=getStarsContainerOld(productReviewsWrap)}else{productDislikeButtonWrap.classList=getProductReviewsInfoClassList(productReviewsWrap);starsContainer=getStarsContainer(productReviewsWrap)}const productDislikeButton=createDislikeButton((()=>dislikeProductOnProductPage(starsContainer)));productDislikeButtonWrap.append(productDislikeButton);insertAfter(productReviewsWrap.parentNode,productDislikeButtonWrap)}function getProductReviewsInfoClassList(productReviewsWrap){return getFirstElement(".tsBodyControl500Medium",productReviewsWrap).classList}function dislikeProductOnProductPage(starsContainer){const productArticle=getProductArticleFromPathname();setStoredRatingValue(productArticle,1);replaceRatingValue(starsContainer,1)}function appendBadReviewsLink(productReviewsWrap,isOld=false){const productReviewsLink=getFirstElement("a",productReviewsWrap);if(productReviewsLink){const productBadReviewsLinkWrap=createDiv();productBadReviewsLinkWrap.classList=isOld?"tsBodyControl400Small":getProductReviewsInfoClassList(productReviewsWrap);const productBadReviewsLink=createLink(`${productReviewsLink.href}?sort=score_asc`,thumbsDownIcon,"align-items: center; display: flex; color: rgba(0, 26, 52, 0.6);");const productBadReviewsLinkSpan=createSpan("Плохие отзывы","padding-left: 8px;");productBadReviewsLink.append(productBadReviewsLinkSpan);productBadReviewsLinkWrap.append(productBadReviewsLink);insertAfter(productReviewsWrap.parentNode,productBadReviewsLinkWrap)}}function appendRatingValue(starsContainer){const productArticle=getProductArticleFromPathname();const storedRatingValue=getStoredRatingValue(productArticle);storedRatingValue&&replaceRatingValue(starsContainer,storedRatingValue);waitForElement(document,CREATE_REVIEW_BUTTON_SELECTOR).then((createReviewButton=>{const reviewsInfoContainer=createReviewButton.parentNode;waitForElement(reviewsInfoContainer,":scope > div:not([data-widget]").then((ratingInfoContainer=>{const ratingValueContainer=ratingInfoContainer.children[0].children[0].children[1];const ratingValueSpan=ratingValueContainer.children[0];const ratingValue=getRatingValue(ratingValueSpan);if(!ratingValue)return;const ratingValueNumber=+ratingValue;setStoredRatingValue(productArticle,ratingValueNumber);replaceRatingValue(starsContainer,ratingValueNumber)}))}))}function getStarsContainerOld(productReviewsWrap){return productReviewsWrap.children[0].children[0].children[1].children[0]}function getStarsContainer(productReviewsWrap){return productReviewsWrap.children[0].children[1]}function setStoredRatingValue(productArticle,ratingValue){setStorageValue(`${productArticle}-rate`,ratingValue)}function getStoredRatingValue(productArticle){return getStoredValue(productArticle,"rate")}function getStoredValue(productArticle,prefix){let storedValue=getStorageValue(`${productArticle}-${prefix}`);
// search in old storage
if(!storedValue){storedValue=getStorageValueOrDefault(`${prefix}-${productArticle}`);if(storedValue){setStorageValue(`${productArticle}-${prefix}`,storedValue);localStorage.removeItem(`${prefix}-${productArticle}`)}}return storedValue}function getRatingValue(ratingValueSpan){let ratingValue;try{const ratingValueSpanArray=removeSpaces(ratingValueSpan.innerHTML).split("/");ratingValue=ratingValueSpanArray.length===2?ratingValueSpanArray[0]:null}catch(e){console.log(`Failed to get ratingValue: ${e.message}`)}return ratingValue}function replaceRatingValue(starsContainer,ratingValue){const starsContainerTextArray=starsContainer.textContent.split(" • ");const reviewsCountText=starsContainerTextArray[1]??starsContainerTextArray[0];starsContainer.textContent=[ratingValue,reviewsCountText].join(" • ")}function initAppendPriceHistory(){waitForElement(document,'[data-widget="webPrice"]').then((priceContainer=>{if(!priceContainer)return;const productArticle=getProductArticleFromPathname();appendPriceHistory(priceContainer,productArticle)}))}function appendPriceHistory(priceContainer,productArticle){const priceSpan=getFirstElement("span",priceContainer);const currentPrice=getNodeInnerNumber(priceSpan,true);appendStoredPriceValue(productArticle,"lp",(storedPriceValue=>currentPrice<storedPriceValue),currentPrice,"Мин. цена","#d6f5b1",priceContainer);appendStoredPriceValue(productArticle,"hp",(storedPriceValue=>currentPrice>storedPriceValue),currentPrice,"Макс. цена","#fed2ea",priceContainer)}function appendStoredPriceValue(productArticle,prefix,compareCondition,currentPrice,label,color,priceContainer){let storedPriceValue=getStoredValue(productArticle,prefix);if(!storedPriceValue||compareCondition(storedPriceValue)){setStorageValue(`${productArticle}-${prefix}`,currentPrice);storedPriceValue=currentPrice}const divText=`${label}: `;const divStyle="color: #000;"+"font-size: 16px;"+"padding: 17px 0px 7px;";const storedPriceContainer=createDiv(divText,divStyle);const spanText=`${storedPriceValue.toLocaleString()} ₽`;const spanStyle="font-weight: bold;"+"padding: 6px 12px;"+"border-radius: 8px;"+`background: ${color};`;const storedPriceSpan=createSpan(spanText,spanStyle);storedPriceContainer.append(storedPriceSpan);priceContainer.parentNode.append(storedPriceContainer)}function removeWebInstallmentPurchase(){waitForElement(document,'[data-widget="webInstallmentPurchase"]').then((webInstallmentPurchase=>{webInstallmentPurchase.remove()}))}function skipFirstGalleryVideo(){waitForElement(document,'[data-widget="webGallery"]').then((webGallery=>{const firstGalleryItem=getFirstElement('[data-index="0"]',webGallery);if(!firstGalleryItem)return;const secondGalleryItem=getFirstElement('[data-index="1"]',webGallery);if(!secondGalleryItem)return;const firstGalleryItemIsImage=[...secondGalleryItem.classList].every((ic=>firstGalleryItem.classList.contains(ic)));if(firstGalleryItemIsImage)return;const observer=new MutationObserver((()=>{observer.disconnect();secondGalleryItem.click()}));observer.observe(firstGalleryItem,{childList:true,subtree:true})}))}function initAppendFavoritesStoredPriceValues(){waitForElement(document,'[data-widget="paginator"]').then((paginator=>{const observer=new MutationObserver(debounce(appendFavoritesStoredPriceValues));observer.observe(paginator,{childList:true,subtree:true})}))}function appendFavoritesStoredPriceValues(){const productCards=getAllElements(PRODUCT_CARDS_SELECTOR);productCards.forEach((productCard=>{if(productCard.hasAttribute("appendStoredPriceValuesPassed"))return;const additionalInfoDiv=getFirstElement(".tsBodyControl400Small",productCard);if(additionalInfoDiv){const notInStock=additionalInfoDiv.innerText==="Нет в наличии";if(notInStock){productCard.setAttribute("appendStoredPriceValuesPassed","");return}}const productCardLink=getFirstElement("a",productCard);if(!productCardLink){hideElement(productCard);return}const productArticle=getProductArticleFromLink(productCardLink);const priceContainer=productCard.children[0].children[1].children[0].children[0];priceContainer.parentNode.style.display="block";appendPriceHistory(priceContainer,productArticle);productCard.setAttribute("appendStoredPriceValuesPassed","")}))}})();