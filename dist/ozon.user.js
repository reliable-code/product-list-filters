// ==UserScript==
// @name         Ozon List Clean
// @description  Remove product cards by filter
// @match        https://www.ozon.ru/*
// @namespace    https://github.com/reliable-code/product-list-filters
// @version      0.7.69670137
// @icon         https://www.google.com/s2/favicons?sz=64&domain=ozon.ru
// @author       reliable-code
// ==/UserScript==

(()=>{"use strict";var __webpack_modules__={33:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */BE:()=>/* binding */insertAfter,
/* harmony export */DJ:()=>/* binding */getAllElements,
/* harmony export */HV:()=>/* binding */createFilterControlNumber,
/* harmony export */V_:()=>/* binding */showElement,
/* harmony export */br:()=>/* binding */waitForElement,
/* harmony export */e6:()=>/* binding */hideElement,
/* harmony export */qX:()=>/* binding */getArrayElementInnerNumber,
/* harmony export */sW:()=>/* binding */updateValue,
/* harmony export */tk:()=>/* binding */getFirstElement,
/* harmony export */wC:()=>/* binding */createDiv});
/* unused harmony exports createFilterControlCheckbox, getFirstElementInnerNumber, getElementInnerNumber, appendFilterControlsIfNeeded */
function getFirstElement(parentNode,selector,logNotFound=false){const element=parentNode.querySelector(selector);logNotFound&&!element&&console.log(`No element found for selector: ${selector}`);return element}function getAllElements(parentNode,selector,logNotFound=false){const elements=parentNode.querySelectorAll(selector);logNotFound&&!elements.length&&console.log(`No elements found for selector: ${selector}`);return elements}function insertAfter(existingNode,newNode){existingNode.parentNode.insertBefore(newNode,existingNode.nextSibling)}function hideElement(element){setElementDisplay(element,"none")}function showElement(element,display="block"){setElementDisplay(element,display)}function setElementDisplay(element,display){element.style.display=display}function updateValue(event,keyName,needReload=true){const{target}=event;const{type}=target;let valueToSet;if(type==="number")valueToSet=target.value;else{if(type!=="checkbox"){console.log(`Unknown input type: ${type}`);return null}valueToSet=target.checked}localStorage.setItem(keyName,valueToSet);needReload&&window.location.reload();return valueToSet}function createFilterControlNumber(titleText,inputValue,inputStep,inputMinValue,inputMaxValue,inputOnChange,controlStyle="",inputStyle=""){const filterControl=createDiv(titleText,controlStyle);const input=createBaseInput(inputOnChange,inputStyle);input.type="number";input.value=inputValue;input.step=inputStep;input.min=inputMinValue;input.max=inputMaxValue;filterControl.append(input);return filterControl}function createBaseInput(inputOnChange,style){const input=document.createElement("input");input.addEventListener("change",inputOnChange);input.style=style;return input}function createDiv(textContent,style=""){const div=document.createElement("div");div.textContent=textContent;div.style=style;return div}function getElementInnerNumber(element,cleanText=false){let elementText=element.innerText;cleanText&&(elementText=elementText.replace(/\D/g,""));const elementNumber=+elementText;return elementNumber}function getArrayElementInnerNumber(array,elementIndex,cleanText=false){const element=array[elementIndex];const elementNumber=getElementInnerNumber(element,cleanText);return elementNumber}function waitForElement(parentNode,selector,timeout=null){return new Promise((resolve=>{const observer=new MutationObserver(mutationCallback);observer.observe(parentNode,{childList:true,subtree:true});let timeoutId=null;timeout&&(timeoutId=setTimeout((()=>{observer.disconnect();console.log(`No element found for selector: ${selector}`);resolve(null)}),timeout));function mutationCallback(){if(parentNode.querySelector(selector)){timeoutId&&clearTimeout(timeoutId);observer.disconnect();resolve(parentNode.querySelector(selector))}}}))}},387:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */P:()=>/* binding */getLocalStorageValueOrDefault});function getLocalStorageValueOrDefault(key,defaultValue){const localStorageItem=localStorage.getItem(key);return localStorageItem?JSON.parse(localStorageItem):defaultValue}},161:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{
/* harmony export */__webpack_require__.d(__webpack_exports__,{
/* harmony export */j:()=>/* binding */thumbsDownIcon});const thumbsDownIcon='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n'+'<path d="M7.99997 4H17.1919C17.9865 4 18.7058 4.47039 19.0243 5.19836L21.8323 11.6167C21.9429 11.8695 22 12.1424 22 12.4184V13C22 14.1046 21.1045 15 20 15H13.5L14.7066 19.4243C14.8772 20.0498 14.5826 20.7087 14.0027 20.9986V20.9986C13.4204 21.2898 12.7134 21.1274 12.3164 20.6114L8.41472 15.5392C8.14579 15.1896 7.99997 14.7608 7.99997 14.3198V14M7.99997 4H2V14H7.99997M7.99997 4V14" stroke="#005bff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>\n'+"</svg>"},504:(module,__unused_webpack___webpack_exports__,__webpack_require__)=>{__webpack_require__.a(module,(async(__webpack_handle_async_dependencies__,__webpack_async_result__)=>{try{
/* harmony import */var _icons__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(161);
/* harmony import */var _common_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(33);
/* harmony import */var _common_storage__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(387);const CATEGORY_NAME=getCategoryName();const MIN_REVIEWS_LOCAL_STORAGE_KEY=`${CATEGORY_NAME}-min-reviews-filter`;const MIN_RATING_LOCAL_STORAGE_KEY=`${CATEGORY_NAME}-min-rating-filter`;const PAGINATOR_CONTENT_SELECTOR="#paginatorContent";const PRODUCT_REVIEWS_WRAP_SELECTOR='[data-widget="webReviewProductScore"]';const COMMENTS_SELECTOR="#comments";const SEARCH_RESULTS_SORT_SELECTOR='[data-widget="searchResultsSort"]';const SEARCH_RESULT_SELECTOR=".widget-search-result-container";const PRODUCT_CARD_RATING_WRAP_SELECTOR=".tsBodyMBold";const CREATE_REVIEW_BUTTON_SELECTOR='[data-widget="createReviewButton"]';const MIN_REVIEWS=50;const MIN_RATING=4.8;let minReviewsValue=(0,_common_storage__WEBPACK_IMPORTED_MODULE_0__.P)(MIN_REVIEWS_LOCAL_STORAGE_KEY,MIN_REVIEWS);let minRatingValue=(0,_common_storage__WEBPACK_IMPORTED_MODULE_0__.P)(MIN_RATING_LOCAL_STORAGE_KEY,MIN_RATING);function getCategoryName(){const{pathname}=window.location;const pathElements=pathname.split("/");const categoryName=pathElements[2]??"common";return categoryName}const paginatorContent=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.tk)(document,PAGINATOR_CONTENT_SELECTOR);const comments=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.tk)(document,COMMENTS_SELECTOR);paginatorContent?await initListClean():comments?comments.scrollIntoView():await appendBadReviewsLinkAndRatingValue();async function initListClean(){const searchResultsSort=await(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.br)(document,SEARCH_RESULTS_SORT_SELECTOR);const controlStyle="padding-left: 14px; margin-top: 12px;";const inputStyle="border: 2px solid #b3bcc5; border-radius: 6px; padding: 6px 10px; width: 90px;";const minReviewsDiv=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.HV)("Минимально отзывов: ",minReviewsValue,"1","1","999999",updateMinReviewsInput,controlStyle,inputStyle);const minRatingDiv=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.HV)("Минимальный рейтинг: ",minRatingValue,"0.1","4.0","5.0",updateMinRatingInput,controlStyle,inputStyle);searchResultsSort.append(minReviewsDiv,minRatingDiv);cleanList();setInterval(cleanList,500)}function updateMinReviewsInput(e){minReviewsValue=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.sW)(e,MIN_REVIEWS_LOCAL_STORAGE_KEY,false)}function updateMinRatingInput(e){minRatingValue=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.sW)(e,MIN_RATING_LOCAL_STORAGE_KEY,false)}function cleanList(){const searchResultContainer=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.tk)(document,SEARCH_RESULT_SELECTOR,true);const productCardsWrap=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.tk)(searchResultContainer,":scope > div",true);const productCards=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.DJ)(productCardsWrap,":scope > div");productCards.forEach((productCard=>{const productCardRatingWrap=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.tk)(productCard,PRODUCT_CARD_RATING_WRAP_SELECTOR);if(!productCardRatingWrap){(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.e6)(productCard);return}const productCardRatingWrapSpans=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.DJ)(productCardRatingWrap,":scope > span",true);const productCardReviewsNumber=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.qX)(productCardRatingWrapSpans,1);const productCardRatingNumber=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.qX)(productCardRatingWrapSpans,0);productCardReviewsNumber<minReviewsValue||productCardRatingNumber<minRatingValue?(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.e6)(productCard):(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.V_)(productCard,"flex")}))}async function appendBadReviewsLinkAndRatingValue(){const productReviewsWrap=await(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.br)(document,PRODUCT_REVIEWS_WRAP_SELECTOR,1500);if(productReviewsWrap){appendBadReviewsLink(productReviewsWrap);await appendRatingValue(productReviewsWrap)}}function appendBadReviewsLink(productReviewsWrap){const productReviewsLink=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.tk)(productReviewsWrap,"a");if(productReviewsLink){const productReviewsWrapParent=productReviewsWrap.parentNode;const productBadReviewsLinkWrap=document.createElement("div");const productBadReviewsLink=document.createElement("a");productBadReviewsLink.innerHTML=_icons__WEBPACK_IMPORTED_MODULE_2__.j;productBadReviewsLink.style="align-items: center; display: flex;";productBadReviewsLink.href=`${productReviewsLink.href}?sort=score_asc`;const productBadReviewsLinkSpan=document.createElement("span");productBadReviewsLinkSpan.style="padding-left: 8px;";productBadReviewsLinkSpan.textContent="Плохие отзывы";productBadReviewsLink.append(productBadReviewsLinkSpan);productBadReviewsLinkWrap.append(productBadReviewsLink);const isInStickyContainer=productReviewsWrapParent.parentNode.matches('[data-widget="stickyContainer"]');if(isInStickyContainer){productBadReviewsLinkWrap.style="margin-top: 10px;";(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.BE)(productReviewsWrapParent,productBadReviewsLinkWrap)}else(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.BE)(productReviewsWrap,productBadReviewsLinkWrap)}}async function appendRatingValue(productReviewsWrap){const createReviewButton=await(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.br)(document,CREATE_REVIEW_BUTTON_SELECTOR);const reviewsInfoContainer=createReviewButton.parentNode;const ratingInfoContainer=await(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.br)(reviewsInfoContainer,":scope > div:not([data-widget]",2e3);const ratingValueContainer=ratingInfoContainer.children[0].children[0].children[1];let ratingValue;try{[ratingValue]=ratingValueContainer.innerText.replace(/\s/g,"").split("/")}catch(e){console.log(`Failed to get ratingValue: ${e.message}`)}if(!ratingValue)return;const starsContainer=productReviewsWrap.children[0].children[0].children[0];const ratingValueDivStyle="margin: 0 4px; color: #005bff;";const ratingValueDiv=(0,_common_dom__WEBPACK_IMPORTED_MODULE_1__.wC)(ratingValue,ratingValueDivStyle);starsContainer.append(ratingValueDiv)}__webpack_async_result__()}catch(e){__webpack_async_result__(e)}}),1)}};
// The module cache
var __webpack_module_cache__={};
// The require function
function __webpack_require__(moduleId){
// Check if module is in cache
var cachedModule=__webpack_module_cache__[moduleId];if(cachedModule!==void 0)return cachedModule.exports;
// Create a new module (and put it into the cache)
var module=__webpack_module_cache__[moduleId]={
// no module.id needed
// no module.loaded needed
exports:{}};
// Execute the module function
__webpack_modules__[moduleId](module,module.exports,__webpack_require__);
// Return the exports of the module
return module.exports}
/* webpack/runtime/async module */
(()=>{var webpackQueues=typeof Symbol==="function"?Symbol("webpack queues"):"__webpack_queues__";var webpackExports=typeof Symbol==="function"?Symbol("webpack exports"):"__webpack_exports__";var webpackError=typeof Symbol==="function"?Symbol("webpack error"):"__webpack_error__";var resolveQueue=queue=>{if(queue&&queue.d<1){queue.d=1;queue.forEach((fn=>fn.r--));queue.forEach((fn=>fn.r--?fn.r++:fn()))}};var wrapDeps=deps=>deps.map((dep=>{if(dep!==null&&typeof dep==="object"){if(dep[webpackQueues])return dep;if(dep.then){var queue=[];queue.d=0;dep.then((r=>{obj[webpackExports]=r;resolveQueue(queue)}),(e=>{obj[webpackError]=e;resolveQueue(queue)}));var obj={};obj[webpackQueues]=fn=>fn(queue);return obj}}var ret={};ret[webpackQueues]=x=>{};ret[webpackExports]=dep;return ret}));__webpack_require__.a=(module,body,hasAwait)=>{var queue;hasAwait&&((queue=[]).d=-1);var depQueues=new Set;var exports=module.exports;var currentDeps;var outerResolve;var reject;var promise=new Promise(((resolve,rej)=>{reject=rej;outerResolve=resolve}));promise[webpackExports]=exports;promise[webpackQueues]=fn=>(queue&&fn(queue),depQueues.forEach(fn),promise["catch"]((x=>{})));module.exports=promise;body((deps=>{currentDeps=wrapDeps(deps);var fn;var getResult=()=>currentDeps.map((d=>{if(d[webpackError])throw d[webpackError];return d[webpackExports]}));var promise=new Promise((resolve=>{fn=()=>resolve(getResult);fn.r=0;var fnQueue=q=>q!==queue&&!depQueues.has(q)&&(depQueues.add(q),q&&!q.d&&(fn.r++,q.push(fn)));currentDeps.map((dep=>dep[webpackQueues](fnQueue)))}));return fn.r?promise:getResult()}),(err=>(err?reject(promise[webpackError]=err):outerResolve(exports),resolveQueue(queue))));queue&&queue.d<0&&(queue.d=0)}})();
/* webpack/runtime/define property getters */
(()=>{
// define getter functions for harmony exports
__webpack_require__.d=(exports,definition)=>{for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:true,get:definition[key]})}})();
/* webpack/runtime/hasOwnProperty shorthand */
(()=>{__webpack_require__.o=(obj,prop)=>Object.prototype.hasOwnProperty.call(obj,prop)})();
// startup
// Load entry module and return exports
// This entry module used 'module' so it can't be inlined
__webpack_require__(504)})();